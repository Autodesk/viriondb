!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function n(e){var n=e.search(i);return-1==n?0:n}var t={},i=/[^\s\u00a0]/,l=e.Pos;e.commands.toggleComment=function(e){e.toggleComment()},e.defineExtension("toggleComment",function(e){e||(e=t);for(var n=this,i=1/0,o=this.listSelections(),r=null,a=o.length-1;a>=0;a--){var c=o[a].from(),m=o[a].to();c.line>=i||(m.line>=i&&(m=l(i,0)),i=c.line,null==r?n.uncomment(c,m,e)?r="un":(n.lineComment(c,m,e),r="line"):"un"==r?n.uncomment(c,m,e):n.lineComment(c,m,e))}}),e.defineExtension("toggleBlockComment",function(e){e||(e=t);for(var n=this,i=1/0,o=this.listSelections(),r=null,a=o.length-1;a>=0;a--){var c=o[a].from(),m=o[a].to();c.line>=i||(m.line>=i&&(m=l(i,0)),i=c.line,null==r?n.uncomment(c,m,e)?r="un":(n.blockComment(c,m,e),r="block"):"un"==r?n.uncomment(c,m,e):n.blockComment(c,m,e))}}),e.defineExtension("lineComment",function(e,o,r){r||(r=t);var a=this,c=a.getModeAt(e),m=r.lineComment||c.lineComment;if(!m)return void((r.blockCommentStart||c.blockCommentStart)&&(r.fullLines=!0,a.blockComment(e,o,r)));var s=a.getLine(e.line);if(null!=s){var f=Math.min(0!=o.ch||o.line==e.line?o.line+1:o.line,a.lastLine()+1),d=null==r.padding?" ":r.padding,u=r.commentBlankLines||e.line==o.line;a.operation(function(){if(r.indent){for(var t=null,o=e.line;f>o;++o){var c=a.getLine(o),s=c.slice(0,n(c));(null==t||t.length>s.length)&&(t=s)}for(var o=e.line;f>o;++o){var c=a.getLine(o),g=t.length;(u||i.test(c))&&(c.slice(0,g)!=t&&(g=n(c)),a.replaceRange(t+m+d,l(o,0),l(o,g)))}}else for(var o=e.line;f>o;++o)(u||i.test(a.getLine(o)))&&a.replaceRange(m+d,l(o,0))})}}),e.defineExtension("blockComment",function(e,n,o){o||(o=t);var r=this,a=r.getModeAt(e),c=o.blockCommentStart||a.blockCommentStart,m=o.blockCommentEnd||a.blockCommentEnd,s=o.blockCommentIndent||!1,f=s,d=f&&r.getLine(e.line).match(/[^ ]/);if(f&&r.indentSelection("add"),d&&r.indentLine(e.line,"subtract"),!c||!m)return void((o.lineComment||a.lineComment)&&0!=o.fullLines&&r.lineComment(e,n,o));var u=null==o.padding?" ":o.padding,g=Math.min(n.line,r.lastLine());g!=e.line&&0==n.ch&&i.test(r.getLine(g))&&--g,e.line>g||r.operation(function(){if(0!=o.fullLines){var t=i.test(r.getLine(g));" "!==m&&r.replaceRange(u+m,l(g)),r.replaceRange(c+u,l(e.line,0));var s=o.blockCommentLead||a.blockCommentLead;if(null!=s)for(var f=e.line+1;g>=f;++f)(f!=g||t)&&r.replaceRange(s+u,l(f,0))}else r.replaceRange(u+m,n),r.replaceRange(c+u,e)})}),e.defineExtension("uncomment",function(e,n,o){function r(){p&&c.indentSelection("subtract")}o||(o=t);var a,c=this,m=c.getModeAt(e),s=Math.min(0!=n.ch||n.line==e.line?n.line:n.line-1,c.lastLine()),f=Math.min(e.line,s),d=o.blockCommentIndent||!1,u=d&&e.line!==n.line,g=o.lineComment||m.lineComment,h=[],C=o.blockCommentStart,b=null==o.padding?" ":o.padding,p=!1;e:if(g){for(var k=f;s>=k;++k){var v=c.getLine(k),L=d?v.indexOf(C):-1;if(L>-1&&(p=!0),-1==L&&(L=v.indexOf(g)),L>-1&&!/comment/.test(c.getTokenTypeAt(l(k,L+1)))&&(L=-1),-1==L&&(k!=s||k==f)&&i.test(v))break e;if(L>-1&&i.test(v.slice(0,L)))break e;h.push(v)}if(c.operation(function(){for(var e=f;s>=e;++e){var n=p?C:g,t=h[e-f],i=t.indexOf(n),o=i+n.length;0>i||(t.slice(o,o+b.length)==b&&(o+=b.length),a=!0,c.replaceRange("",l(e,i),l(e,o)))}}),r(),a)return!0}var x=o.blockCommentStart||m.blockCommentStart,y=o.blockCommentEnd||m.blockCommentEnd,M=x&&" "===y;if(!x||!y)return!1;var S=o.blockCommentLead||m.blockCommentLead,E=c.getLine(f),O=s==f?E:c.getLine(s),R=E.indexOf(x),T=u?O.length:O.lastIndexOf(y);if(-1==T&&f!=s&&(O=c.getLine(--s),T=O.lastIndexOf(y)),r(),-1==R||!M&&-1==T||!/comment/.test(c.getTokenTypeAt(l(f,R+1)))||!M&&!/comment/.test(c.getTokenTypeAt(l(s,T+1))))return!1;var j=E.lastIndexOf(x,e.ch),A=-1==j?-1:E.slice(0,e.ch).indexOf(y,j+x.length);if(-1!=j&&-1!=A&&A+y.length!=e.ch)return!1;A=O.indexOf(y,n.ch);var w=O.slice(n.ch).lastIndexOf(x,A-n.ch);return j=-1==A||-1==w?-1:n.ch+w,-1!=A&&-1!=j&&j!=n.ch?!1:(c.operation(function(){var e=u?0:y.length;c.replaceRange("",l(s,T-(b&&O.slice(T-b.length,T)==b?b.length:0)),l(s,T+e));var n=R+x.length;if(b&&E.slice(n,n+b.length)==b&&(n+=b.length),c.replaceRange("",l(f,R),l(f,n)),S)for(var t=f+1;s>=t;++t){var o=c.getLine(t),r=o.indexOf(S);if(-1!=r&&!i.test(o.slice(0,r))){var a=r+S.length;b&&o.slice(a,a+b.length)==b&&(a+=b.length),c.replaceRange("",l(t,r),l(t,a))}}}),!0)})}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../lib/codemirror")):"function"==typeof define&&define.amd?define(["../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function n(e){a=e.getModeAt({line:0,ch:0}),c=a.helperType||a.name,m=TypesUtil.cmModeToType(c)}function t(e){var n=l(),t=o(),i={indent:!0,lineComment:n,blockCommentStart:t.start,blockCommentEnd:t.end};e.toggleComment(i)}function i(e){var n=o(),t=l(),i=r(),a=n.end&&" "!==n.end,c=!a,m={fullLines:c,lineComment:t,blockCommentStart:n.start,blockCommentEnd:n.end,blockCommentIndent:i};e.toggleBlockComment(m)}function l(){var e=a.lineComment||null;switch(m){case"html":switch(c){case"slim":return"/";case"haml":return"-#";case"jade":return"//-"}break;case"css":switch(c){case"scss":case"sass":case"less":case"stylus":return"//"}break;case"js":switch(c){case"coffeescript":case"livescript":return"#";default:return"//"}}return e}function o(){var e=a.blockCommentStart||"/*",n=a.blockCommentEnd||"*/";switch(m){case"html":switch(c){case"slim":return{start:"/! ",end:" "};case"haml":return{start:"/ ",end:" "};case"jade":return{start:"// ",end:" "};default:return{start:"<!--",end:"-->"}}break;case"js":if("coffeescript"===c)return{start:"###",end:"###"}}return{start:e,end:n}}function r(){if("html"!==m)return!1;switch(c){case"slim":case"haml":case"jade":return!0;default:return!1}}var a,c,m,s=e.keyMap.extended_base={fallthrough:"default"},f=e.keyMap["default"]==e.keyMap.macDefault,d=f?"Cmd-":"Ctrl-",u=f?"Alt-":"Shift-";s[d+"/"]=function(e){n(e),t(e)},s[u+d+"/"]=function(e){n(e),i(e)},e.normalizeKeyMap(s)}),Hub.pub("cm-update-keybindings",{});